graph_id: "render://_kernel/md/simple-k1"
version: "0.1.0"

attrs:
  - { key: "profile", value: "specframe-k1" }
  - { key: "domain", value: "graphbrain.render" }
  - { key: "depends_on", value: "spec://_kernel/gf/gf0-k1" }
  - { key: "depends_on", value: "spec://_kernel/spec/specframe-k1" }

nodes:
  # --- Root spec node (valid SpecFrame shape) ---------------------------------
  - id: "render://_kernel/md/simple-k1"
    kind: "spec"
    status: "normative"
    profile: "specframe-k1"
    title: "Simple Markdown Renderer K1"
    summary: >
      Deterministic, profile-agnostic Markdown rendering for any GF0 frame.
      Produces a uniform human-readable view (header, node index, edge index,
      optional contains tree, and meta graphs).

  # --- Sections ---------------------------------------------------------------
  - id: "section.1.scope"
    kind: "section"
    status: "normative"
    title: "Scope"
    order: 1

  - id: "section.2.inputs"
    kind: "section"
    status: "normative"
    title: "Inputs"
    order: 2

  - id: "section.3.outputs"
    kind: "section"
    status: "normative"
    title: "Outputs"
    order: 3

  - id: "section.4.algorithm"
    kind: "section"
    status: "normative"
    title: "Render Algorithm"
    order: 4

  - id: "section.5.determinism"
    kind: "section"
    status: "normative"
    title: "Determinism Rules"
    order: 5

  - id: "section.6.meta"
    kind: "section"
    status: "normative"
    title: "Meta Graph Rendering"
    order: 6

  - id: "section.7.errors"
    kind: "section"
    status: "normative"
    title: "Errors and Warnings"
    order: 7

  - id: "section.8.examples"
    kind: "section"
    status: "informative"
    title: "Example Output Shape"
    order: 8

  # --- References -------------------------------------------------------------
  - id: "ref.spec.gf0-k1"
    kind: "spec_ref"
    status: "informative"
    target_graph_id: "spec://_kernel/gf/gf0-k1"
    label: "GF0 schema"

  - id: "ref.spec.specframe-k1"
    kind: "spec_ref"
    status: "informative"
    target_graph_id: "spec://_kernel/spec/specframe-k1"
    label: "SpecFrame K1 schema"

  # --- Properties (machine-readable knobs) -----------------------------------
  - id: "property.renderer_id"
    kind: "property"
    status: "normative"
    label: "Renderer ID"
    value: "simple-md-k1"

  - id: "property.output_extension"
    kind: "property"
    status: "normative"
    label: "Output extension"
    value: ".md"

  - id: "property.output_path_rule"
    kind: "property"
    status: "normative"
    label: "Output path rule"
    value: "docs/{frameurl_path}/v{version}/README.md"

  - id: "property.contains_edge_type"
    kind: "property"
    status: "normative"
    label: "Contains edge type"
    value: "contains"

  - id: "property.ordering"
    kind: "property"
    status: "normative"
    label: "Ordering keys"
    node_order: "by node.id ascending (bytewise)"
    edge_order: "by (from,to,type,id) ascending (bytewise; missing id treated as empty)"
    meta_order: "by (graph_id,version) ascending (bytewise)"

  - id: "property.field_exclusions"
    kind: "property"
    status: "normative"
    label: "Field exclusion list"
    excluded_node_fields: ["id", "kind", "attrs", "metrics"]
    excluded_edge_fields: ["from", "to", "type", "attrs", "metrics"]

  # --- Clauses ---------------------------------------------------------------
  - id: "clause.scope"
    kind: "clause"
    status: "normative"
    label: "Scope"
    text: >
      This renderer MUST accept any valid GraphFrame K0 (GF0) and MUST emit a single Markdown
      document representing the frame. It MUST NOT rely on higher-level frame semantics
      (SpecFrame, LawFrame, etc.) beyond what is present in the GF0 structure.

  - id: "clause.input.gf0_required"
    kind: "clause"
    status: "normative"
    label: "Input must be valid GF0"
    text: >
      Inputs MUST be structurally valid GF0: graph_id and version non-empty, attrs/nodes/edges/meta
      lists present, node IDs unique, and edges must reference existing node IDs.

  - id: "clause.output.header"
    kind: "clause"
    status: "normative"
    label: "Header section"
    text: >
      The output MUST begin with:
        - H1: graph_id
        - A short metadata block containing version, node_count, edge_count, meta_count.

  - id: "clause.output.sections"
    kind: "clause"
    status: "normative"
    label: "Required sections"
    text: >
      The output MUST include these sections in this order:
        1) Header (H1 + metadata)
        2) Nodes (index)
        3) Edges (index)
        4) Contains Tree (if any edges of type 'contains' exist)
        5) Meta Graphs (if meta_count > 0)

  - id: "clause.nodes.rendering"
    kind: "clause"
    status: "normative"
    label: "Node rendering"
    text: >
      Nodes MUST be rendered as a Markdown list in deterministic order.
      For each node:
        - heading line: **<id>**  (kind: <kind>)
        - if label exists: include "label: <label>"
        - attrs table if attrs present: columns [key, value, vtype, desc]
        - metrics table if metrics present: columns [name, value, unit, desc]
        - extra fields: any additional node keys (e.g. title/status/text/summary/profile/order)
          MUST be rendered under an "Extra fields" sub-bullet as a YAML code block.

  - id: "clause.edges.rendering"
    kind: "clause"
    status: "normative"
    label: "Edge rendering"
    text: >
      Edges MUST be rendered as a Markdown table in deterministic order with columns:
        [from, to, type, id(optional), attrs(optional), metrics(optional)].
      If attrs/metrics exist, they MUST be rendered as compact JSON within the table cell.

  - id: "clause.contains_tree"
    kind: "clause"
    status: "normative"
    label: "Contains tree rendering"
    text: >
      If any edges exist with type == property.contains_edge_type, the renderer MUST attempt
      to render a tree rooted at node id == graph_id (if such a node exists), otherwise a forest.
      If cycles or multiple parents are detected, the renderer MUST still output a best-effort
      forest and MUST emit a warning (see Errors and Warnings).

  - id: "clause.meta.rendering"
    kind: "clause"
    status: "normative"
    label: "Meta graph rendering"
    text: >
      Each meta subgraph MUST be rendered after the primary frame, separated by a horizontal rule,
      using the same algorithm recursively. Meta graphs MUST be ordered deterministically.

  - id: "clause.determinism.newlines"
    kind: "clause"
    status: "normative"
    label: "Newlines and whitespace"
    text: >
      Output MUST use LF newlines. Trailing whitespace MUST be stripped from all lines.
      The document MUST end with exactly one LF.

  - id: "clause.determinism.sorting"
    kind: "clause"
    status: "normative"
    label: "Deterministic ordering"
    text: >
      Node, edge, and meta ordering MUST follow property.ordering. Implementations in different
      languages MUST produce byte-identical Markdown for the same input frame.

  - id: "clause.errors.warn_codes"
    kind: "clause"
    status: "normative"
    label: "Warnings"
    text: >
      The renderer SHOULD emit warnings (non-fatal) for:
        - unknown/extra top-level keys on nodes/edges (still rendered under Extra fields)
        - contains cycles or multiple parents
        - missing root node id == graph_id (contains tree becomes a forest)

  - id: "example.output_shape"
    kind: "example"
    status: "informative"
    label: "Markdown skeleton"
    text: |
      # <graph_id>
      - version: <version>
      - nodes: <n>
      - edges: <m>
      - meta: <k>

      ## Nodes
      - **node.a** (kind: section)
        - attrs:
          | key | value | vtype | desc |
          | --- | --- | --- | --- |
          | ... | ... | ... | ... |
        - Extra fields:
          ```yml
          title: Example
          order: 1
          ```

      ## Edges
      | from | to | type | id | attrs | metrics |
      | --- | --- | --- | --- | --- | --- |
      | ... | ... | ... | ... | ... | ... |

      ## Contains Tree
      - <root>
        - <child>

      ## Meta Graphs
      ---

edges:
  - { from: "render://_kernel/md/simple-k1", to: "section.1.scope",       type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "section.2.inputs",      type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "section.3.outputs",     type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "section.4.algorithm",   type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "section.5.determinism", type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "section.6.meta",        type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "section.7.errors",      type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "section.8.examples",    type: "contains" }

  - { from: "render://_kernel/md/simple-k1", to: "property.renderer_id",        type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "property.output_extension",   type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "property.output_path_rule",   type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "property.contains_edge_type", type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "property.ordering",           type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "property.field_exclusions",   type: "contains" }

  - { from: "section.1.scope",       to: "clause.scope",                type: "contains" }
  - { from: "section.2.inputs",      to: "clause.input.gf0_required",   type: "contains" }
  - { from: "section.3.outputs",     to: "clause.output.header",        type: "contains" }
  - { from: "section.3.outputs",     to: "clause.output.sections",      type: "contains" }
  - { from: "section.4.algorithm",   to: "clause.nodes.rendering",      type: "contains" }
  - { from: "section.4.algorithm",   to: "clause.edges.rendering",      type: "contains" }
  - { from: "section.4.algorithm",   to: "clause.contains_tree",        type: "contains" }
  - { from: "section.6.meta",        to: "clause.meta.rendering",       type: "contains" }
  - { from: "section.5.determinism", to: "clause.determinism.newlines", type: "contains" }
  - { from: "section.5.determinism", to: "clause.determinism.sorting",  type: "contains" }
  - { from: "section.7.errors",      to: "clause.errors.warn_codes",    type: "contains" }
  - { from: "section.8.examples",    to: "example.output_shape",        type: "contains" }

  - { from: "render://_kernel/md/simple-k1", to: "ref.spec.gf0-k1",       type: "contains" }
  - { from: "render://_kernel/md/simple-k1", to: "ref.spec.specframe-k1", type: "contains" }

meta: []
